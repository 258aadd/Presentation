# IndexedDB 测试指南

## 🧪 测试步骤

### 1. 清除旧数据
首先清除可能存在的localStorage数据：
1. 打开 `debug.html`
2. 点击 **"清除所有数据"** 按钮
3. 确认清除操作

### 2. 测试IndexedDB存储
1. 在debug页面中选择测试文件：
   - 选择您的11MB视频文件
   - 选择一个markdown文件（或点击"创建测试文件"下载测试用的markdown）
2. 点击 **"测试上传"** 按钮
3. 观察控制台输出

### 3. 预期结果
成功的日志应该显示：
```
[时间] LOG: 测试开始...
[时间] LOG: 开始读取视频文件: xxx.mp4 video/mp4 11.12 MB
[时间] LOG: 视频文件读取成功
[时间] LOG: 开始读取Markdown文件: xxx.md xxx KB
[时间] LOG: Markdown文件读取成功
[时间] LOG: 文件读取完成
[时间] LOG: 开始保存数据到IndexedDB... {userId: "test-user", title: "测试标题"}
[时间] LOG: 数据大小: 14.xx MB
[时间] LOG: 数据保存成功，大小: 14.xx MB
[时间] LOG: 事务完成
```

### 4. 验证存储
1. 点击 **"显示存储数据"** 按钮
2. 应该看到IndexedDB中的数据信息

### 5. 测试主应用
1. 打开 `index.html`
2. 尝试上传相同的文件
3. 验证浏览和存储管理功能

## 🔍 故障排除

### 如果仍然看到localStorage错误：
1. 确保使用的是更新后的debug.html
2. 刷新页面，确保JavaScript重新加载
3. 检查浏览器控制台是否有IndexedDB初始化错误

### 如果IndexedDB不工作：
1. 检查浏览器是否支持IndexedDB
2. 确保不在隐私/无痕模式下
3. 检查浏览器设置是否禁用了数据库存储

### 常见错误：
- **"数据库未初始化"**: 等待页面完全加载后再测试
- **"事务失败"**: 刷新页面重试
- **"浏览器不支持"**: 使用现代浏览器（Chrome 23+, Firefox 10+, Safari 7+, Edge 12+）

## 📊 性能对比

| 存储方式 | 容量限制 | 11MB视频 | 性能 |
|---------|----------|----------|------|
| localStorage | ~5MB | ❌ 失败 | 同步 |
| IndexedDB | ~几GB | ✅ 成功 | 异步 |

## 🎯 成功标志

- ✅ 11MB视频文件成功上传
- ✅ 数据保存到IndexedDB
- ✅ 存储管理页面显示正确信息
- ✅ 浏览功能正常工作
- ✅ 无localStorage相关错误

现在您应该能够成功上传11MB的视频文件了！
